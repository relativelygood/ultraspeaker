#include <Arduino.h>
#include "BluetoothA2DPSink.h"
#include "esp_bt.h"

BluetoothA2DPSink a2dp_sink;

void audio_data_callback(const uint8_t *data, uint32_t length) {
    int32_t sum = 0;
    int samples = length / 2; // 16-bit PCM

    const int16_t *pcm = (const int16_t *)data;

    for (int i = 0; i < samples; i++) {
        sum += abs(pcm[i]);
    }

    int32_t avg = sum / samples;

    if (avg > 5) {
        Serial.println("ðŸ”Š Audio present");
    }
}


void setup() {
    Serial.begin(115200);
    delay(1500);

    esp_bt_controller_mem_release(ESP_BT_MODE_BLE);

    a2dp_sink.set_stream_reader(audio_data_callback, false);
    a2dp_sink.start("ESP32 Audio Test");
}

void loop() {}
